---
import { SITE_TITLE, SITE_DESCRIPTION, SITE_URL, SITE_EMAIL, SITE_PHONE } from "../consts";

interface Props {
  type?: 'website' | 'medicalBusiness' | 'article' | 'service' | 'profile';
  title?: string;
  description?: string;
  url?: string;
  author?: {
    name: string;
    url?: string;
  };
  article?: {
    datePublished: string;
    dateModified?: string;
    headline: string;
  };
  service?: {
    name: string;
    description: string;
    areaServed: string;
    serviceType: string;
  };
}

const { 
  type = 'website', 
  description = SITE_DESCRIPTION, 
  url = SITE_URL,
  author,
  article,
  service 
} = Astro.props;

const currentUrl = url || `${SITE_URL}${Astro.url.pathname}`;

// Schema de base pour le site web
const baseSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": SITE_TITLE,
  "description": SITE_DESCRIPTION,
  "url": SITE_URL,
  "inLanguage": "fr-FR",
  "potentialAction": {
    "@type": "SearchAction",
    "target": `${SITE_URL}/blog?q={search_term_string}`,
    "query-input": "required name=search_term_string"
  }
};

// Schema pour l'organisation (hypnothérapeute)
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": ["Organization", "MedicalBusiness", "HealthAndBeautyBusiness"],
  "name": SITE_TITLE,
  "description": SITE_DESCRIPTION,
  "url": SITE_URL,
  "logo": `${SITE_URL}/favicon.png`,
  "image": `${SITE_URL}/images/logo.png`,
  "telephone": SITE_PHONE,
  "email": SITE_EMAIL,
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "28 RUE EDOUARD FAUCHARD",
    "addressLocality": "Le Mans",
    "postalCode": "72000",
    "addressRegion": "Sarthe",
    "addressCountry": "FR"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": 48.0061,
    "longitude": 0.1996
  },
  "openingHours": [
    "Mo-Fr 09:00-19:00"
  ],
  "areaServed": {
    "@type": "City",
    "name": "Le Mans"
  },
  "serviceArea": {
    "@type": "GeoCircle",
    "geoMidpoint": {
      "@type": "GeoCoordinates",
      "latitude": 48.0061,
      "longitude": 0.1996
    },
    "geoRadius": "50000"
  },
  "medicalSpecialty": "Hypnotherapy",
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "name": "Services d'hypnothérapie",
    "itemListElement": [
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Hypnothérapie individuelle",
          "description": "Séances d'hypnose personnalisées pour traiter le stress, l'anxiété, les phobies et addictions",
          "serviceType": "Hypnotherapy"
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Hypnose en entreprise",
          "description": "Ateliers et formations en hypnose pour améliorer le bien-être au travail",
          "serviceType": "Corporate Wellness"
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Hypnose à domicile",
          "description": "Séances d'hypnothérapie dans le confort de votre domicile",
          "serviceType": "Home Healthcare"
        }
      }
    ]
  },
  "sameAs": [
    // Ajoutez ici les réseaux sociaux si disponibles
  ]
};

// Schema pour la personne (thérapeute)
const personSchema = {
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "Hypnothérapeute La Kokosphère",
  "jobTitle": "Hypnothérapeute certifiée",
  "description": "Hypnothérapeute certifiée spécialisée dans la méthode ericksonienne",
  "url": SITE_URL,
  "email": SITE_EMAIL,
  "telephone": SITE_PHONE,
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "28 RUE EDOUARD FAUCHARD",
    "addressLocality": "Le Mans",
    "postalCode": "72000",
    "addressRegion": "Sarthe",
    "addressCountry": "FR"
  },
  "worksFor": {
    "@type": "Organization",
    "name": SITE_TITLE
  },
  "hasOccupation": {
    "@type": "Occupation",
    "name": "Hypnothérapeute",
    "occupationalCategory": "29-1125.00",
    "skills": ["Hypnose ericksonienne", "Gestion du stress", "Traitement des phobies", "Accompagnement des addictions"]
  }
};

let schemas: any[] = [baseSchema, organizationSchema, personSchema];

// Ajouter des schemas spécifiques selon le type de page
if (type === 'article' && article) {
  const articleSchema = {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": article.headline,
    "description": description,
    "url": currentUrl,
    "datePublished": article.datePublished,
    "dateModified": article.dateModified || article.datePublished,
    "author": {
      "@type": "Person",
      "name": author?.name || "La Kokosphère",
      "url": author?.url || SITE_URL
    },
    "publisher": {
      "@type": "Organization",
      "name": SITE_TITLE,
      "url": SITE_URL,
      "logo": {
        "@type": "ImageObject",
        "url": `${SITE_URL}/favicon.png`
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": currentUrl
    },
    "inLanguage": "fr-FR"
  };
  schemas.push(articleSchema);
}

if (type === 'service' && service) {
  const serviceSchema = {
    "@context": "https://schema.org",
    "@type": "Service",
    "name": service.name,
    "description": service.description,
    "serviceType": service.serviceType,
    "provider": {
      "@type": "Organization",
      "name": SITE_TITLE,
      "url": SITE_URL
    },
    "areaServed": {
      "@type": "City",
      "name": service.areaServed
    },
    "availableLanguage": "fr"
  };
  schemas.push(serviceSchema);
}

// Breadcrumb schema pour toutes les pages sauf la homepage
if (Astro.url.pathname !== '/') {
  const pathSegments = Astro.url.pathname.split('/').filter((segment: string) => segment);
  const breadcrumbList = pathSegments.map((segment: string, index: number) => {
    const position = index + 2; // +2 car on commence après "Home"
    const name = segment.charAt(0).toUpperCase() + segment.slice(1).replace(/-/g, ' ');
    const url = `${SITE_URL}/${pathSegments.slice(0, index + 1).join('/')}`;
    
    return {
      "@type": "ListItem",
      "position": position,
      "name": name,
      "item": url
    };
  });

  const breadcrumbSchema = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Accueil",
        "item": SITE_URL
      },
      ...breadcrumbList
    ]
  };
  schemas.push(breadcrumbSchema);
}
---

{schemas.map(schema => (
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />
))}