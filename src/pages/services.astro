---
import SanityContent from '../components/SanityContent.astro';
import { CALENDLY_URL, SITE_TITLE } from '../consts';
import BaseLayout from '../layouts/BaseLayout.astro';
import { getServices } from '../lib/sanity';

// Récupérer les services depuis Sanity
const services = await getServices();
// Trier les services par 'order' si présent, sinon par titre
const sortedServices = [...services].sort((a, b) => {
  const orderA = typeof a.order === 'number' ? a.order : 999;
  const orderB = typeof b.order === 'number' ? b.order : 999;
  if (orderA !== orderB) return orderA - orderB;
  return a.title.localeCompare(b.title);
});
---

<BaseLayout title={`Services - ${SITE_TITLE}`} description="Découvrez mes services d'hypnothérapie : stress, anxiété, phobies, addictions, confiance en soi. Tarifs et accompagnement personnalisé pour votre bien-être.">
		
		<!-- Hero Section -->
		<section class="bg-gradient-to-br from-primary-50 to-secondary-50 section-padding">
			<div class="container-max">
				<div class="text-center">
					<h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
						Mes services d'hypnothérapie
					</h1>
					<p class="text-xl text-gray-600 max-w-3xl mx-auto">
						Un accompagnement personnalisé pour vous aider à surmonter vos difficultés et retrouver votre bien-être.
					</p>
				</div>
			</div>
		</section>

		<!-- Services dynamiques (section principale) -->
		<section class="section-padding bg-white">
			<div class="container-max">
				{sortedServices.map((service: any, idx: number) => {
					// Mapping des titres de services vers les ancres des domaines d'expertise
					const anchorMapping: { [key: string]: string } = {
						'Stress et Anxiété': 'stress',
						'Phobies': 'phobies',
						'Addictions': 'addictions',
						'Confiance en soi': 'confiance',
						'Troubles du sommeil': 'sommeil',
						'Développement personnel': 'developpement'
					};
					
					const anchorId = anchorMapping[service.title] || service.title
						.toLowerCase()
						.replace(/[éèê]/g, 'e')
						.replace(/[àâ]/g, 'a')
						.replace(/[ùû]/g, 'u')
						.replace(/[ôö]/g, 'o')
						.replace(/[îï]/g, 'i')
						.replace(/[ç]/g, 'c')
						.replace(/[^a-z0-9\s-]/g, '')
						.replace(/\s+/g, '-')
						.replace(/-+/g, '-')
						.replace(/^-|-$/g, '');
					
					return (
					<div id={anchorId} class="mb-20 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center scroll-mt-20">
						{/* Colonne texte - alterne entre gauche et droite */}
						<div class={idx % 2 === 0 ? '' : 'lg:order-2'}>
							<h2 class="text-3xl font-bold text-gray-900 mb-6">{service.title}</h2>
							<div class="prose prose-lg text-gray-600 mb-6">
								<p class="mb-4">{service.description}</p>
								<SanityContent content={service.body} />
							</div>
							<div class="flex flex-wrap items-center gap-6 mb-6">
								{service.price && (
									<span class="inline-block text-2xl font-bold text-primary-600 bg-primary-50 rounded-lg px-4 py-2">{service.price}</span>
								)}
								{service.duration && (
									<span class="inline-block text-gray-500 bg-gray-100 rounded-lg px-4 py-2">{service.duration}</span>
								)}
							</div>
							<a href={CALENDLY_URL} class="btn-primary">
								Prendre rendez-vous
							</a>
						</div>
						{/* Colonne image - alterne entre droite et gauche */}
						<div class={idx % 2 === 0 ? '' : 'lg:order-1'}>
							{service.image && service.image.type === "url" && service.image.externalUrl ? (
								<div class="bg-gradient-to-br from-primary-100 to-secondary-100 rounded-2xl p-8">
									<div class="aspect-square bg-white rounded-xl flex items-center justify-center shadow-lg overflow-hidden">
										<img src={service.image.externalUrl} alt={service.image.altText || service.title} class="w-full h-full object-cover rounded-xl" loading="lazy" />
									</div>
								</div>
							) : service.image && service.image.type === "upload" && service.image.uploadedImage && service.image.uploadedImage.asset ? (
								<div class="bg-gradient-to-br from-primary-100 to-secondary-100 rounded-2xl p-8">
									<div class="aspect-square bg-white rounded-xl flex items-center justify-center shadow-lg overflow-hidden">
										<img src={`https://cdn.sanity.io/images/j41wv78y/production/${service.image.uploadedImage.asset._ref.replace('image-', '').replace('-webp', '.webp')}?w=800&h=600&fit=crop&auto=format`} alt={service.title} class="w-full h-full object-cover rounded-xl" loading="lazy" />
									</div>
								</div>
							) : (
								<div class="bg-gradient-to-br from-primary-100 to-secondary-100 rounded-2xl p-8">
									<div class="aspect-square bg-white rounded-xl flex items-center justify-center shadow-lg overflow-hidden">
										<div class="flex items-center justify-center text-gray-400">
											<svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
											</svg>
										</div>
									</div>
								</div>
							)}
						</div>
					</div>
					);
				})}
			</div>
		</section>

		<!-- Tarifs -->
		<section class="section-padding bg-gray-50">
			<div class="container-max">
				<div class="text-center mb-16">
					<h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
						Mes tarifs
					</h2>
					<p class="text-xl text-gray-600 max-w-3xl mx-auto">
						Des tarifs transparents et accessibles pour un accompagnement professionnel de qualité.
					</p>
				</div>

				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
					<!-- Consultation initiale -->
					<div class="bg-white rounded-xl p-8 shadow-sm border-2 border-gray-100">
						<div class="text-center mb-6">
							<h3 class="text-xl font-semibold text-gray-900 mb-2">Consultation initiale</h3>
							<div class="text-3xl font-bold text-primary-600 mb-2">60€</div>
							<p class="text-gray-600">1h30</p>
						</div>
						<ul class="space-y-3 mb-8">
							<li class="flex items-center">
								<svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
								</svg>
								Évaluation de votre situation
							</li>
							<li class="flex items-center">
								<svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
								</svg>
								Définition des objectifs
							</li>
							<li class="flex items-center">
								<svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
								</svg>
								Plan d'accompagnement personnalisé
							</li>
						</ul>
						<a href={CALENDLY_URL} class="w-full btn-primary text-center">
							Prendre rendez-vous
						</a>
					</div>

					<!-- Séance individuelle -->
					<div class="bg-white rounded-xl p-8 shadow-lg border-2 border-primary-200 relative">
						<div class="absolute -top-4 left-1/2 transform -translate-x-1/2">
							<span class="bg-primary-600 text-white px-4 py-1 rounded-full text-sm font-medium">Recommandé</span>
						</div>
						<div class="text-center mb-6">
							<h3 class="text-xl font-semibold text-gray-900 mb-2">Séance individuelle</h3>
							<div class="text-3xl font-bold text-primary-600 mb-2">80€</div>
							<p class="text-gray-600">1h</p>
						</div>
						<ul class="space-y-3 mb-8">
							<li class="flex items-center">
								<svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
								</svg>
								Séance d'hypnothérapie complète
							</li>
							<li class="flex items-center">
								<svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
								</svg>
								Techniques personnalisées
							</li>
							<li class="flex items-center">
								<svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
								</svg>
								Suivi et conseils
							</li>
						</ul>
						<a href={CALENDLY_URL} class="w-full btn-primary text-center">
							Prendre rendez-vous
						</a>
					</div>

					<!-- Pack 5 séances -->
					<div class="bg-white rounded-xl p-8 shadow-sm border-2 border-gray-100">
						<div class="text-center mb-6">
							<h3 class="text-xl font-semibold text-gray-900 mb-2">Pack 5 séances</h3>
							<div class="text-3xl font-bold text-primary-600 mb-2">350€</div>
							<p class="text-gray-600">Économisez 50€</p>
						</div>
						<ul class="space-y-3 mb-8">
							<li class="flex items-center">
								<svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
								</svg>
								5 séances d'hypnothérapie
							</li>
							<li class="flex items-center">
								<svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
								</svg>
								Accompagnement complet
							</li>
							<li class="flex items-center">
								<svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
								</svg>
								Suivi personnalisé
							</li>
						</ul>
						<a href={CALENDLY_URL} class="w-full btn-primary text-center">
							Prendre rendez-vous
						</a>
					</div>
				</div>

				<div class="text-center mt-12">
					<p class="text-gray-600 mb-4">
						* Les tarifs incluent la TVA. Paiement accepté : espèces, chèque, carte bancaire.
					</p>
					<p class="text-gray-600">
						** Possibilité de séances à distance via visioconférence (même tarif).
					</p>
				</div>
			</div>
		</section>

		<!-- CTA Section -->
		<section class="section-padding bg-primary-600">
			<div class="container-max text-center">
				<h2 class="text-3xl md:text-4xl font-bold text-white mb-6">
					Prêt(e) à commencer votre transformation ?
				</h2>
				<p class="text-xl text-primary-100 mb-8 max-w-2xl mx-auto">
					Prenez rendez-vous pour une première consultation et découvrez comment l'hypnothérapie peut vous aider.
				</p>
				<a href={CALENDLY_URL} class="bg-white text-primary-600 hover:bg-gray-100 font-medium py-4 px-8 rounded-lg transition-colors duration-200 inline-flex items-center justify-center text-lg">
					Prendre rendez-vous
				</a>
			</div>
		</section>

</BaseLayout> 