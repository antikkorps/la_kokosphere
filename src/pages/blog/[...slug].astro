---
import SanityContent from '../../components/SanityContent.astro';
import BlogPost from '../../layouts/BlogPost.astro';
import { getPosts } from '../../lib/sanity';

export async function getStaticPaths() {
	// Récupérer tous les articles depuis Sanity
	const posts = await getPosts();
	
	// Générer les routes pour chaque article
	return posts.map((post) => ({
		params: { slug: post.slug.current },
		props: { post },
	}));
}

const { post } = Astro.props;

if (!post) {
	return Astro.redirect('/404');
}
---

<BlogPost 
	_id={post._id}
	title={post.title}
	description={post.description}
	pubDate={new Date(post.publishedAt)}
	tags={post.tags}
	mainImage={post.mainImage}
	author={post.author}
>
	<SanityContent content={post.body} />
</BlogPost>
